<html data-namespace-typo3-fluid="true" lang="en"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
	xmlns:s="http://typo3.org/ns/ApacheSolrForTypo3/Solr/ViewHelpers"
>

<f:comment>
    <!--
 * This file is part of the package itzbund/gsb-core of the GSB 11 Project by ITZBund
 * (c) Matthias Peltzer <matthias.peltzer@digitaspixelpark.com> 2023
 * (c) Kai Ole Hartwig <o.hartwig@moselwal.de> 2023
 * Licensed under the GPL 2.0 License.
 -->
</f:comment>

<f:layout name="Split"/>

<f:section name="content">
	<div class="d-grid gap-3" id="tx-solr-search">

		<div class="row">
			<div class="tx-solr-search-form col-12">
				<f:render arguments="{search:search, additionalFilters:additionalFilters, pluginNamespace: pluginNamespace, resultSet: resultSet}" partial="Search/Form" section="Form" />
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 d-flex">
				<f:if condition="{resultSet.isAutoCorrected}">
					<f:then>
					<p class="searched-for text-break mb-0">
						<f:translate arguments="{0: resultSet.initialQueryString}" extensionName="solr" key="no_results_nothing_found">Nothing found for "%s". </f:translate>
						<f:translate arguments="{0: resultSet.correctedQueryString}" extensionName="solr" key="no_results_showing_results_suggestion">Showing results for "%s".</f:translate>
					</p>
					</f:then>

					<f:else>
						<f:if condition="{resultSet.usedQuery.query}">
						<p class="searched-for text-break mb-0">
							<f:translate arguments="{0: resultSet.usedQuery.query}" extensionName="solr" key="results_searched_for">Searched for "%s"</f:translate>
						</p>
						</f:if>
					</f:else>
				</f:if>

				<f:if condition="{resultSet.hasSpellCheckingSuggestions}">
					<f:then>
						<f:translate extensionName="solr" key="didYouMean">Did you mean</f:translate>
						<f:for as="suggestion" each="{resultSet.spellCheckingSuggestions}">
							<f:link.page additionalParams="{q: suggestion.suggestion}">{suggestion.suggestion}</f:link.page>
						</f:for> ?
					</f:then>
				</f:if>

				<f:if condition="{resultSet.allResultCount}">
					<p class="result-found text-uppercase ms-3 mb-0">
						<f:if condition="{resultSet.allResultCount} == 1">
							<f:then>
								<f:translate arguments="{0: resultSet.usedSearch.queryTime}" extensionName="solr" key="results_found.singular">Found 1 result.</f:translate>
							</f:then>
							<f:else>
								<f:translate arguments="{0: resultSet.allResultCount, 1: resultSet.usedSearch.queryTime}" extensionName="solr" key="results_found">Found %d results.</f:translate>
							</f:else>
						</f:if>
					</p>
				</f:if>
			</div>
		</div>

        <div class="accordion filter-accordion">
            <div class="accordion-item filter-accordion-item">
                <button aria-controls="filter" aria-expanded="false" class="accordion-button filter-accordion-button collapsed" data-bs-target="#filter" data-bs-toggle="collapse" id="filterCollapse" type="button">
                    <f:translate key="LLL:EXT:gsb_core/Resources/Private/Language/locallang.xlf:solr.filterButtonOff" />
                </button>
                <div class="accordion-collapse filter-accordion-collapse collapse" id="filter">

                    <f:if condition="{resultSet.hasSearched}">
                        <f:if condition="{resultSet.usedSearchRequest.contextTypoScriptConfiguration.searchFaceting}">
                            <div class="accordion-body ps-0 pe-0">
                                <h3 class="mb-3"><f:translate key="LLL:EXT:gsb_core/Resources/Private/Language/locallang.xlf:solr.filterSearchResults" />:</h3>
                                 <div class="row" id="tx-solr-facets-in-use">
                                    <f:render arguments="{resultSet:resultSet}" partial="Result/Facets" section="Facets" />
                                </div>
                                <f:if condition="{resultSet.facets.used -> f:count()}">
                                    <div class="facets-filter">
                                        <f:render arguments="{resultSet:resultSet}" partial="Result/FacetsActive" section="FacetsActive" />
                                    </div>
                                </f:if>
                            </div>
                        </f:if>
                    </f:if>
                </div>
            </div>
        </div>

        <f:if condition="{resultSet.hasSearched}">
            <f:if condition="{resultSet.usedSearchRequest.contextTypoScriptConfiguration.searchSorting}">
                <f:render arguments="{resultSet:resultSet}" partial="Result/Sorting" section="Sorting" />
            </f:if>
        </f:if>

        <div class="row justify-content-center">
			<div class="col-12 col-lg-10 col-xl-8">
				<f:if condition="{resultSet.hasSearched}">
					<f:if condition="{resultSet.searchresults.hasGroups}">
						<f:then>
							<f:for as="group" each="{resultSet.searchresults.groups}">
								<h2>{group.groupname}</h2>
								<f:for as="groupItem" each="{group.groupitems}">
									<strong>{groupItem.groupValue} <span>({groupItem.allResultCount})</span></strong>
									<s:groupItemPaginate groupItem="{groupItem}" resultSet="{resultSet}">
										<ol class="results-list" start="{pagination.resultCountStart}">
											<f:for as="document" each="{documents}">
												<f:render arguments="{resultSet:resultSet, document:document}" partial="Result/Document" section="Document" />
											</f:for>
										</ol>
									</s:groupItemPaginate>
								</f:for>
							</f:for>
						</f:then>
						<f:else>
                            <f:if condition="{resultSet.allResultCount}">
                                <f:then>
                                    <ol class="results-list list-unstyled" data-start="{pagination.startRecordNumber}">
                                        <f:for as="document" each="{resultSet.searchResults}">
                                            <f:render arguments="{resultSet: resultSet, document: document}" partial="Result/Document" section="Document" />
                                        </f:for>
                                    </ol>
                                    <f:render arguments="{resultSet: resultSet, pagination: pagination, currentPage: currentPage}" partial="Result/Pagination" section="Pagination"/>
                                </f:then>
                                <f:else>
                                    <f:comment><!-- defined in Typoscript only --></f:comment>
                                    <div class="ce-bodytext">
                                        <f:format.html><f:translate extensionName="solr" key="results_found_nothing">Es wurden keine Suchergebnisse gefunden. Überprüfen Sie, ob alle Wörter richtig geschrieben sind. Versuchen Sie allgemeinere Suchbegriffe.</f:translate></f:format.html>
                                    </div>
                                </f:else>
                            </f:if>
						</f:else>
					</f:if>
				</f:if>
			</div>
		</div>
	</div>
</f:section>

<f:section name="extra">
	<div class="d-grid gap-3" id="tx-solr-search-functions">
		<div class="hidden-xs">
			<f:if condition="{resultSet.usedSearchRequest.contextTypoScriptConfiguration.searchLastSearches}">
				<f:render arguments="{resultSet:resultSet}" partial="Search/LastSearches" section="LastSearches" />
			</f:if>
		</div>
		<div class="hidden-xs">
			<f:if condition="{resultSet.usedSearchRequest.contextTypoScriptConfiguration.searchFrequentSearches}">
				<f:render arguments="{resultSet:resultSet}" partial="Search/FrequentlySearched" section="FrequentlySearched" />
			</f:if>
		</div>
	</div>
</f:section>

</html>
